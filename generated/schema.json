{
  "components": {
    "schemas": {
      "Auth": {
        "type": "object",
        "required": [
          "redirections",
          "anonymous",
          "signUp",
          "roles",
          "email",
          "gravatar",
          "locale",
          "password",
          "sms",
          "webauthn",
          "accessToken",
          "refreshToken",
          "mfa"
        ],
        "properties": {
          "redirections": {
            "type": "object",
            "required": [
              "clientUrl",
              "allowedUrls"
            ],
            "properties": {
              "clientUrl": {
                "$ref": "#/components/schemas/Url"
              },
              "allowedUrls": {
                "description": "TODO we should implement wildcards soon",
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "anonymous": {
            "type": "object",
            "required": [
              "enabled"
            ],
            "properties": {
              "enabled": {
                "type": "boolean",
                "default": false
              }
            }
          },
          "signUp": {
            "type": "object",
            "required": [
              "enabled"
            ],
            "properties": {
              "enabled": {
                "type": "boolean",
                "default": true
              }
            }
          },
          "roles": {
            "type": "object",
            "required": [
              "default",
              "allowed"
            ],
            "properties": {
              "default": {
                "$ref": "#/components/schemas/UserRole"
              },
              "allowed": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/UserRole"
                },
                "default": [
                  "user",
                  "me"
                ]
              }
            }
          },
          "email": {
            "type": "object",
            "required": [
              "passwordless",
              "verification",
              "domains",
              "emails"
            ],
            "properties": {
              "passwordless": {
                "type": "object",
                "required": [
                  "enabled"
                ],
                "properties": {
                  "enabled": {
                    "type": "boolean",
                    "default": false
                  }
                }
              },
              "verification": {
                "type": "object",
                "required": [
                  "required"
                ],
                "properties": {
                  "required": {
                    "type": "boolean",
                    "default": true
                  }
                }
              },
              "domains": {
                "type": "object",
                "required": [
                  "allowed",
                  "blocked"
                ],
                "properties": {
                  "allowed": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/Domain"
                    }
                  },
                  "blocked": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/Domain"
                    }
                  }
                }
              },
              "emails": {
                "type": "object",
                "required": [
                  "allowed",
                  "blocked"
                ],
                "properties": {
                  "allowed": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/Email"
                    }
                  },
                  "blocked": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/Email"
                    }
                  }
                }
              }
            }
          },
          "gravatar": {
            "type": "object",
            "required": [
              "enabled",
              "default",
              "rating"
            ],
            "properties": {
              "enabled": {
                "type": "boolean",
                "default": true
              },
              "default": {
                "type": "string",
                "enum": [
                  "blank",
                  "mp",
                  "identicon",
                  "monsterid",
                  "wavatar",
                  "retro",
                  "robohash",
                  "404"
                ],
                "default": "blank"
              },
              "rating": {
                "type": "string",
                "enum": [
                  "g",
                  "r",
                  "x",
                  "pg"
                ],
                "default": "g"
              }
            }
          },
          "locale": {
            "type": "object",
            "required": [
              "default",
              "allowed"
            ],
            "properties": {
              "default": {
                "$ref": "#/components/schemas/Locale"
              },
              "allowed": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/Locale"
                }
              }
            }
          },
          "password": {
            "type": "object",
            "required": [
              "hibp",
              "minLength"
            ],
            "properties": {
              "hibp": {
                "type": "object",
                "required": [
                  "enabled"
                ],
                "properties": {
                  "enabled": {
                    "type": "boolean",
                    "default": false
                  }
                }
              },
              "minLength": {
                "type": "number",
                "minimum": 3,
                "default": 9
              }
            }
          },
          "sms": {
            "type": "object",
            "required": [
              "passwordless",
              "provider",
              "twilio"
            ],
            "properties": {
              "passwordless": {
                "type": "object",
                "required": [
                  "enabled"
                ],
                "properties": {
                  "enabled": {
                    "type": "boolean",
                    "default": false
                  }
                }
              },
              "provider": {
                "type": [
                  "string",
                  "null"
                ],
                "enum": [
                  "twilio",
                  null
                ],
                "default": null
              },
              "twilio": {
                "description": "TODO: required if provider is set to \"twilio\"",
                "type": "object",
                "required": [
                  "accountSid",
                  "authToken",
                  "from",
                  "messagingServiceId"
                ],
                "properties": {
                  "accountSid": {
                    "default": "",
                    "oneOf": [
                      {
                        "enum": [
                          ""
                        ]
                      },
                      {
                        "type": "string"
                      }
                    ]
                  },
                  "authToken": {
                    "default": "",
                    "oneOf": [
                      {
                        "enum": [
                          ""
                        ]
                      },
                      {
                        "type": "string"
                      }
                    ]
                  },
                  "from": {
                    "default": "",
                    "oneOf": [
                      {
                        "enum": [
                          ""
                        ]
                      },
                      {
                        "type": "string"
                      }
                    ]
                  },
                  "messagingServiceId": {
                    "default": "",
                    "oneOf": [
                      {
                        "enum": [
                          ""
                        ]
                      },
                      {
                        "type": "string"
                      }
                    ]
                  }
                }
              }
            }
          },
          "webauthn": {
            "type": "object",
            "required": [
              "enabled",
              "relyingParty",
              "attestation"
            ],
            "properties": {
              "enabled": {
                "type": "boolean",
                "default": false
              },
              "relyingParty": {
                "type": "object",
                "required": [
                  "origins"
                ],
                "properties": {
                  "origins": {
                    "description": "! In the cloud, we are using the application name\nname: string\nTODO to be further analysed",
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              },
              "attestation": {
                "type": "object",
                "required": [
                  "timeout"
                ],
                "properties": {
                  "timeout": {
                    "type": "number",
                    "default": 60000
                  }
                }
              }
            }
          },
          "accessToken": {
            "type": "object",
            "required": [
              "expiresIn",
              "customClaims"
            ],
            "properties": {
              "expiresIn": {
                "type": "number",
                "default": 900
              },
              "customClaims": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                }
              }
            }
          },
          "refreshToken": {
            "type": "object",
            "required": [
              "expiresIn"
            ],
            "properties": {
              "expiresIn": {
                "type": "number",
                "default": 43200
              }
            }
          },
          "mfa": {
            "type": "object",
            "required": [
              "enabled",
              "totp"
            ],
            "properties": {
              "enabled": {
                "type": "boolean",
                "default": false
              },
              "totp": {
                "description": "TODO: required if mfa is enabled",
                "type": "object"
              }
            }
          }
        },
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Domain": {
        "type": "string",
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Email": {
        "type": "string",
        "pattern": "^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$",
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "EnvironmentVariable": {
        "type": "string",
        "pattern": "[a-zA-Z_]{1,}[a-zA-Z0-9_]*",
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Functions": {
        "type": "object",
        "required": [
          "node"
        ],
        "properties": {
          "node": {
            "type": "object",
            "required": [
              "version"
            ],
            "properties": {
              "version": {
                "type": "integer",
                "enum": [
                  16
                ]
              }
            }
          }
        },
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Global": {
        "type": "object",
        "required": [
          "environment",
          "name"
        ],
        "properties": {
          "environment": {
            "description": "User-defined environment variables that are spread over all services",
            "type": "object"
          },
          "name": {
            "description": "Name of the application",
            "type": "string",
            "default": "Nhost application"
          }
        },
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Hasura": {
        "type": "object",
        "required": [
          "jwtSecrets"
        ],
        "properties": {
          "jwtSecrets": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/JWTSecret"
            }
          }
        },
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Ip": {
        "type": "string",
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "JWTSecret": {
        "description": "* https://hasura.io/docs/latest/auth/authentication/jwt/",
        "type": "object",
        "properties": {
          "claims_map": {
            "type": "object"
          },
          "claims_format": {
            "type": "string",
            "enum": [
              "json",
              "stringified_json"
            ],
            "default": "json"
          },
          "audience": {
            "type": "string"
          },
          "issuer": {
            "type": "string"
          },
          "allowed_skew": {
            "type": "number"
          },
          "header": {
            "type": "string"
          }
        },
        "allOf": [
          {
            "oneOf": [
              {
                "required": [
                  "type",
                  "key"
                ],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "HS256",
                      "HS512",
                      "RS256",
                      "RS384",
                      "RS512",
                      "Ed25519",
                      "HS384"
                    ],
                    "default": "HS256"
                  },
                  "key": {
                    "type": "string"
                  }
                }
              },
              {
                "required": [
                  "jwk_url"
                ],
                "properties": {
                  "jwk_url": {
                    "type": [
                      "string",
                      "null"
                    ],
                    "default": null
                  }
                }
              }
            ]
          },
          {
            "oneOf": [
              {
                "required": [
                  "claims_namespace"
                ],
                "properties": {
                  "claims_namespace": {
                    "type": "string",
                    "default": "https://hasura.io/jwt/claims"
                  }
                }
              },
              {
                "required": [
                  "claims_namespace_path"
                ],
                "properties": {
                  "claims_namespace_path": {
                    "type": "string"
                  }
                }
              },
              {
                "not": {
                  "anyOf": [
                    {
                      "required": [
                        "claims_namespace"
                      ],
                      "properties": {
                        "claims_namespace": {
                          "type": "string",
                          "default": "https://hasura.io/jwt/claims"
                        }
                      }
                    },
                    {
                      "required": [
                        "claims_namespace_path"
                      ],
                      "properties": {
                        "claims_namespace_path": {
                          "type": "string"
                        }
                      }
                    }
                  ]
                }
              }
            ]
          }
        ],
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Locale": {
        "type": "string",
        "minLength": 2,
        "maxLength": 2,
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Port": {
        "type": "integer",
        "minimum": 0,
        "maximum": 65535,
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Smtp": {
        "type": "object",
        "required": [
          "user",
          "password",
          "sender",
          "host",
          "port",
          "secure",
          "method"
        ],
        "properties": {
          "user": {
            "default": "",
            "oneOf": [
              {
                "enum": [
                  ""
                ]
              },
              {
                "type": "string"
              }
            ]
          },
          "password": {
            "default": "",
            "oneOf": [
              {
                "enum": [
                  ""
                ]
              },
              {
                "type": "string"
              }
            ]
          },
          "sender": {
            "description": "? more advanced validation?",
            "default": "",
            "oneOf": [
              {
                "enum": [
                  ""
                ]
              },
              {
                "type": "string"
              }
            ]
          },
          "host": {
            "default": "",
            "oneOf": [
              {
                "enum": [
                  ""
                ]
              },
              {
                "type": "string"
              }
            ]
          },
          "port": {
            "$ref": "#/components/schemas/Port"
          },
          "secure": {
            "type": "boolean",
            "default": false
          },
          "method": {
            "type": "string",
            "enum": [
              "PLAIN",
              "LOGIN"
            ],
            "default": "PLAIN"
          }
        },
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Storage": {
        "type": "object",
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "Url": {
        "type": "string",
        "$schema": "http://json-schema.org/draft-04/schema#"
      },
      "UserRole": {
        "type": "string",
        "$schema": "http://json-schema.org/draft-04/schema#"
      }
    }
  },
  "type": "object",
  "required": [
    "global",
    "hasura",
    "storage",
    "functions",
    "auth",
    "smtp"
  ],
  "properties": {
    "global": {
      "$ref": "#/components/schemas/Global"
    },
    "hasura": {
      "$ref": "#/components/schemas/Hasura"
    },
    "storage": {
      "$ref": "#/components/schemas/Storage"
    },
    "functions": {
      "$ref": "#/components/schemas/Functions"
    },
    "auth": {
      "$ref": "#/components/schemas/Auth"
    },
    "smtp": {
      "$ref": "#/components/schemas/Smtp"
    }
  },
  "$schema": "http://json-schema.org/draft-04/schema#"
}
